#!/usr/bin/env python3
import asyncio
import signal
import sys
from main_bot import GoalPredictionBot

class Application:
    def __init__(self):
        self.bot = None
        
    async def startup(self):
        """Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„"""
        print("ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¨ÙˆØª ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù‡Ø¯Ù...")
        self.bot = GoalPredictionBot()
        await self.bot.run()
        
    async def shutdown(self):
        """Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„"""
        print("ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª...")
        if self.bot:
            await self.bot.application.stop()
            await self.bot.application.shutdown()
            
def signal_handler(signum, frame):
    """Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…"""
    print(f"ğŸ“¡ ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© {signum}")
    asyncio.create_task(app.shutdown())
    sys.exit(0)

if __name__ == "__main__":
    app = Application()
    
    # ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    
    try:
        asyncio.run(app.startup())
    except KeyboardInterrupt:
        print("â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: {e}")
    finally:
        asyncio.run(app.shutdown())